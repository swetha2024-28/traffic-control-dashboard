<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chennai Traffic Control Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin { animation: spin 1s linear infinite; }
        
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 300ms; }
        .transition-colors { transition-property: background-color, border-color, color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        
        .bg-gray-900 { background-color: #111827; }
        .bg-gray-800 { background-color: #1f2937; }
        .bg-gray-700 { background-color: #374151; }
        .bg-gray-600 { background-color: #4b5563; }
        .text-white { color: #ffffff; }
        .text-gray-300 { color: #d1d5db; }
        .text-gray-400 { color: #9ca3af; }
        .border-gray-700 { border-color: #374151; }
        .border-gray-600 { border-color: #4b5563; }
        
        .ring-4 { box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .street-pattern {
            background-image: 
                linear-gradient(rgba(75, 85, 99, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(75, 85, 99, 0.3) 1px, transparent 1px);
            background-size: 50px 50px;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #475569 0%, #334155 50%, #1e293b 100%);
        }
        
        /* Map container styling */
        #map-container {
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* Custom marker styling */
        .junction-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .junction-marker.selected {
            transform: scale(1.4);
            z-index: 1000;
            box-shadow: 0 0 0 3px #3b82f6, 0 4px 15px rgba(0, 0, 0, 0.4);
        }
        
        .junction-marker.low { background-color: #10b981; }
        .junction-marker.medium { background-color: #f59e0b; }
        .junction-marker.high { background-color: #ef4444; }
        .junction-marker.emergency { 
            background-color: #dc2626; 
            animation: pulse 1s infinite;
        }
        
        /* Custom popup styling */
        .leaflet-popup-content-wrapper {
            background: #1f2937;
            color: #f9fafb;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }
        
        .leaflet-popup-tip {
            background: #1f2937;
        }
        
        .leaflet-popup-content {
            margin: 12px 15px;
            line-height: 1.4;
        }
        
        .popup-content {
            min-width: 200px;
        }
        
        .popup-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #3b82f6;
        }
        
        .popup-detail {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
            font-size: 13px;
        }
        
        .popup-label {
            color: #9ca3af;
        }
        
        .popup-value {
            color: #f9fafb;
            font-weight: 500;
        }
        
        .popup-phase {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #374151;
        }
        
        /* Traffic flow indicators */
        .traffic-indicators {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .traffic-indicator {
            width: 8px;
            height: 32px;
            border-radius: 4px;
            animation: pulse 2s infinite;
        }
        
        .traffic-indicator:nth-child(2) {
            animation-delay: 0.5s;
        }
        
        .traffic-indicator:nth-child(3) {
            animation-delay: 1s;
        }
        
        /* Traffic signal visualization */
        .traffic-signal {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            padding: 5px;
            background: #2d3748;
            border-radius: 5px;
        }
        
        .signal-direction {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .signal-direction-label {
            font-size: 10px;
            margin-bottom: 5px;
            color: #cbd5e0;
        }
        
        .signal-lights {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .signal-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            opacity: 0.3;
        }
        
        .signal-light.active {
            opacity: 1;
            box-shadow: 0 0 5px currentColor;
        }
        
        .signal-light.red { background-color: #ef4444; }
        .signal-light.yellow { background-color: #f59e0b; }
        .signal-light.green { background-color: #10b981; }
        
        /* Camera feed styling */
        .camera-feed {
            width: 100%;
            height: 160px;
            background: #000;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .camera-feed video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .camera-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a202c;
            color: #718096;
        }
        
        /* Button states */
        .btn-accepted {
            background-color: #10b981 !important;
            cursor: not-allowed !important;
        }
        
        .btn-declined {
            background-color: #6b7280 !important;
            cursor: not-allowed !important;
        }
        
        .btn-resolved {
            background-color: #10b981 !important;
            cursor: not-allowed !important;
        }
    </style>
</head>
<body class="h-screen bg-gray-900 text-white">
    <div id="dashboard" class="h-screen flex flex-col">
        <!-- Header -->
        <div class="bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700">
            <div class="flex items-center space-x-4">
                <h1 class="text-xl font-bold text-blue-400">Chennai Traffic Control</h1>
                <div id="current-time" class="text-sm text-gray-300"></div>
            </div>
            <div class="flex items-center space-x-6">
                <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    <span class="text-sm">System Online</span>
                </div>
                <div class="text-sm">
                    Active Incidents: <span id="incident-count" class="text-red-400 font-bold">3</span>
                </div>
                <button id="emergency-toggle" class="px-4 py-2 rounded font-medium bg-gray-600 text-gray-300 hover:bg-gray-500 transition-colors">
                    Emergency Mode OFF
                </button>
            </div>
        </div>

        <div class="flex-1 flex">
            <!-- Left Panel -->
            <div class="w-1/4 bg-gray-800 p-4 space-y-4 overflow-y-auto">
                <!-- Junction Selector -->
                <div>
                    <h3 class="text-sm font-semibold mb-2 text-gray-300">Selected Junction</h3>
                    <select id="junction-selector" class="w-full bg-gray-700 text-white p-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none">
                        <option value="anna-salai-mount">Anna Salai - Mount Road</option>
                        <option value="omr-sholinganallur">OMR - Sholinganallur</option>
                        <option value="ecr-mahabalipuram">ECR - Mahabalipuram Rd</option>
                    </select>
                </div>

                <!-- Live Metrics -->
                <div class="bg-gray-700 p-3 rounded">
                    <h3 class="text-sm font-semibold mb-3 text-gray-300">Live Metrics</h3>
                    <div class="space-y-3" id="metrics-panel">
                        <!-- Metrics will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Incident Feed -->
                <div class="bg-gray-700 p-3 rounded flex-1">
                    <h3 class="text-sm font-semibold mb-3 text-gray-300">Live Incidents</h3>
                    <div class="space-y-2" id="incidents-feed">
                        <!-- Incidents will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Center - Map View -->
            <div class="flex-1 bg-gray-700 relative">
                <div class="absolute top-4 left-4 bg-gray-800 p-2 rounded z-10">
                    <h3 class="text-sm font-semibold text-gray-300 mb-2">Chennai Traffic Map</h3>
                    <p class="text-xs text-gray-400">Real-time junction monitoring</p>
                </div>
                
                <!-- Map Container -->
                <div id="map-container"></div>
                
                <!-- Traffic flow indicators -->
                <div class="traffic-indicators">
                    <div class="traffic-indicator bg-green-400"></div>
                    <div class="traffic-indicator bg-yellow-400"></div>
                    <div class="traffic-indicator bg-red-400"></div>
                </div>
                
                <!-- Legend -->
                <div class="absolute bottom-4 left-20 bg-gray-800 bg-opacity-90 p-3 rounded shadow-lg z-10">
                    <h4 class="text-xs font-semibold mb-2 text-white">Traffic Density</h4>
                    <div class="space-y-1 text-xs">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-400 rounded-full"></div>
                            <span class="text-gray-300">Low (0-40%)</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-yellow-400 rounded-full"></div>
                            <span class="text-gray-300">Medium (40-70%)</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-red-400 rounded-full"></div>
                            <span class="text-gray-300">High (70%+)</span>
                        </div>
                        <div class="flex items-center space-x-2 mt-2 pt-1 border-t border-gray-600">
                            <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                            <span class="text-gray-300">Emergency</span>
                        </div>
                    </div>
                </div>

                <!-- Map attribution -->
                <div class="absolute bottom-4 right-4 text-xs text-gray-400 bg-gray-800 bg-opacity-80 px-2 py-1 rounded z-10">
                    ¬© OpenStreetMap contributors
                </div>
            </div>

            <!-- Right Panel -->
            <div class="w-1/4 bg-gray-800 p-4 space-y-4 overflow-y-auto">
                <!-- Live Camera Feed -->
                <div class="bg-gray-700 p-3 rounded">
                    <h3 class="text-sm font-semibold mb-3 text-gray-300">Live Camera Feed</h3>
                    <div id="camera-feed-container">
                        <!-- Camera feed will be populated by JavaScript -->
                    </div>
                </div>

                <!-- AI Recommendations -->
                <div class="bg-gray-700 p-3 rounded">
                    <h3 class="text-sm font-semibold mb-3 text-gray-300">AI Recommendations</h3>
                    <div class="space-y-3" id="ai-recommendations">
                        <!-- AI recommendations will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Signal Controls -->
                <div class="bg-gray-700 p-3 rounded">
                    <h3 class="text-sm font-semibold mb-3 text-gray-300">Signal Control</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">Manual Override</span>
                            <button id="manual-override" class="px-3 py-1 rounded text-xs font-medium bg-gray-600 hover:bg-gray-500 text-white transition-colors">
                                Override OFF
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 mt-3" id="signal-controls">
                            <!-- Signal control buttons will be populated by JavaScript -->
                        </div>
                        
                        <div class="mt-3">
                            <button id="emergency-preemption" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white p-2 rounded text-xs font-medium transition-colors">
                                Emergency Preemption
                            </button>
                        </div>
                    </div>
                </div>

                <!-- System Health -->
                <div class="bg-gray-700 p-3 rounded">
                    <h3 class="text-sm font-semibold mb-3 text-gray-300">System Health</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">Cameras Online</span>
                            <div class="flex items-center space-x-1">
                                <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-xs text-green-400">24/24</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">Model Performance</span>
                            <div class="flex items-center space-x-1">
                                <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-xs text-green-400">98.5%</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">Network Latency</span>
                            <div class="flex items-center space-x-1">
                                <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-xs text-green-400">12ms</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">Data Processing</span>
                            <div class="flex items-center space-x-1">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-xs text-green-400">Active</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Incident Detail Modal -->
    <div id="incident-modal" class="fixed inset-0 modal-overlay flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 p-6 rounded-lg max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div id="modal-content">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script>
        // Dashboard State
        let dashboardState = {
            selectedJunction: 'anna-salai-mount',
            emergencyMode: false,
            manualOverride: false,
            selectedIncident: null,
            aiRecommendation: {
                suggestion: 'Extend NS green phase by 15s to clear queue',
                confidence: 93,
                reason: 'High density detected, queue length increasing',
                accepted: null
            },
            junctions: {
                'anna-salai-mount': {
                    name: 'Anna Salai - Mount Road',
                    density: 85,
                    queueLength: 12,
                    waitTime: 95,
                    status: 'high',
                    phase: 'NS Green',
                    timeLeft: 28,
                    emergencyVehicle: false,
                    accident: false,
                    phases: ['NS Green', 'NS Yellow', 'NS Red', 'EW Green', 'EW Yellow', 'EW Red'],
                    coordinates: [13.0827, 80.2707], // Chennai center coordinates
                    videoId: 'anna-salai', // Different video for each junction
                    signalState: {
                        NS: { red: false, yellow: false, green: true },
                        EW: { red: true, yellow: false, green: false }
                    }
                },
                'omr-sholinganallur': {
                    name: 'OMR - Sholinganallur',
                    density: 62,
                    queueLength: 8,
                    waitTime: 45,
                    status: 'medium',
                    phase: 'EW Green',
                    timeLeft: 15,
                    emergencyVehicle: true,
                    accident: false,
                    phases: ['NS Green', 'NS Yellow', 'NS Red', 'EW Green', 'EW Yellow', 'EW Red'],
                    coordinates: [12.8992, 80.2289], // OMR Sholinganallur coordinates
                    videoId: 'omr', // Different video for each junction
                    signalState: {
                        NS: { red: true, yellow: false, green: false },
                        EW: { red: false, yellow: false, green: true }
                    }
                },
                'ecr-mahabalipuram': {
                    name: 'ECR - Mahabalipuram Rd',
                    density: 34,
                    queueLength: 4,
                    waitTime: 22,
                    status: 'low',
                    phase: 'NS Red',
                    timeLeft: 8,
                    emergencyVehicle: false,
                    accident: true,
                    phases: ['NS Green', 'NS Yellow', 'NS Red', 'EW Green', 'EW Yellow', 'EW Red'],
                    coordinates: [12.6208, 80.1944], // ECR Mahabalipuram coordinates
                    videoId: 'ecr', // Different video for each junction
                    signalState: {
                        NS: { red: true, yellow: false, green: false },
                        EW: { red: false, yellow: false, green: true }
                    }
                }
            },
            incidents: [
                {
                    id: 1,
                    type: 'emergency',
                    location: 'OMR Junction',
                    message: 'Ambulance approaching from south',
                    time: '14:23',
                    priority: 'high',
                    details: 'Emergency vehicle detected via OpenCV. Estimated arrival: 2 minutes.',
                    actions: ['Clear traffic signal', 'Alert nearby junctions', 'Contact emergency services'],
                    resolved: false,
                    vehicleType: 'Ambulance',
                    direction: 'South to North',
                    estimatedArrival: '2 min',
                    junctionId: 'omr-sholinganallur'
                },
                {
                    id: 2,
                    type: 'accident',
                    location: 'ECR Junction',
                    message: 'Minor collision detected',
                    time: '14:20',
                    priority: 'medium',
                    details: 'OpenCV detected sudden stop pattern. 2 vehicles involved, minor damage.',
                    actions: ['Dispatch traffic police', 'Contact nearest hospital', 'Redirect traffic', 'Clear debris'],
                    resolved: false,
                    severity: 'Minor',
                    vehiclesInvolved: 2,
                    injuries: 'None reported',
                    junctionId: 'ecr-mahabalipuram'
                },
                {
                    id: 3,
                    type: 'congestion',
                    location: 'Anna Salai',
                    message: 'Queue length exceeding threshold',
                    time: '14:18',
                    priority: 'low',
                    details: 'Vehicle queue detected at 15+ vehicles. Suggested timing adjustment.',
                    actions: ['Extend green phase', 'Optimize signal timing', 'Monitor queue length'],
                    resolved: false,
                    queueLength: 15,
                    suggestion: 'Extend NS green by 20s',
                    junctionId: 'anna-salai-mount'
                }
            ],
            // Track which popups are open
            openPopups: {},
            // Track resolved incidents
            resolvedIncidents: {}
        };

        // Traffic video URLs (unique for each junction)
        const trafficVideos = {
            'anna-salai': 'https://player.vimeo.com/video/807037240?h=2e4b0e8e8d&autoplay=1&loop=1&title=0&byline=0&portrait=0',
            'omr': 'https://player.vimeo.com/video/807037240?h=2e4b0e8e8d&autoplay=1&loop=1&title=0&byline=0&portrait=0',
            'ecr': 'https://player.vimeo.com/video/807037240?h=2e4b0e8e8d&autoplay=1&loop=1&title=0&byline=0&portrait=0'
        };

        // Map variables
        let map;
        let markers = {};

        // Initialize the map
        function initMap() {
            // Create map centered on Chennai
            map = L.map('map-container', {
                zoomControl: true,
                scrollWheelZoom: true,
                doubleClickZoom: true,
                boxZoom: true,
                keyboard: true,
                dragging: true,
                zoomSnap: 0.5,
                zoomDelta: 0.5
            }).setView([13.0827, 80.2707], 11);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18
            }).addTo(map);
            
            // Add junction markers to the map
            updateMapJunctions();
        }

        // Utility Functions
        function getStatusColor(status) {
            switch(status) {
                case 'high': return 'bg-red-500';
                case 'medium': return 'bg-yellow-500';
                case 'low': return 'bg-green-500';
                default: return 'bg-gray-500';
            }
        }

        function getPriorityColor(priority) {
            switch(priority) {
                case 'high': return 'border-l-red-500 bg-red-50';
                case 'medium': return 'border-l-yellow-500 bg-yellow-50';
                case 'low': return 'border-l-blue-500 bg-blue-50';
                default: return 'border-l-gray-500 bg-gray-50';
            }
        }

        function getPhaseColor(phase) {
            if (phase.includes('Green')) return 'text-green-400';
            if (phase.includes('Yellow')) return 'text-yellow-400';
            if (phase.includes('Red')) return 'text-red-400';
            return 'text-gray-400';
        }

        function getIncidentIcon(type) {
            switch(type) {
                case 'emergency': return '‚ö°';
                case 'accident': return '‚ö†Ô∏è';
                case 'congestion': return 'üë•';
                default: return 'üîî';
            }
        }

        // Update Functions
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString();
        }

        function updateMetrics() {
            const junction = dashboardState.junctions[dashboardState.selectedJunction];
            const metricsPanel = document.getElementById('metrics-panel');
            
            metricsPanel.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-xs text-gray-400">Traffic Density</span>
                    <div class="flex items-center space-x-2">
                        <div class="w-20 bg-gray-600 rounded-full h-2">
                            <div class="h-2 rounded-full transition-all duration-500 ${getStatusColor(junction.status)}" style="width: ${junction.density}%"></div>
                        </div>
                        <span class="text-sm font-bold">${Math.round(junction.density)}%</span>
                    </div>
                </div>
                <div class="flex justify-between">
                    <span class="text-xs text-gray-400">Queue Length</span>
                    <span class="text-sm font-bold">${junction.queueLength} vehicles</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-xs text-gray-400">Avg Wait Time</span>
                    <span class="text-sm font-bold">${Math.round(junction.waitTime)}s</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-xs text-gray-400">Current Phase</span>
                    <span class="text-sm font-bold ${getPhaseColor(junction.phase)}">${junction.phase}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-xs text-gray-400">Time Left</span>
                    <span class="text-sm font-bold">${junction.timeLeft}s</span>
                </div>
                ${dashboardState.manualOverride ? '<div class="bg-yellow-900 p-2 rounded border border-yellow-600"><span class="text-xs text-yellow-300 font-medium">Manual Override Active</span></div>' : ''}
            `;
        }

        function updateIncidentsFeed() {
            const incidentsFeed = document.getElementById('incidents-feed');
            const activeIncidents = dashboardState.incidents.filter(i => !i.resolved);
            const resolvedIncidents = dashboardState.incidents.filter(i => i.resolved);
            
            document.getElementById('incident-count').textContent = activeIncidents.length;
            
            incidentsFeed.innerHTML = activeIncidents.map(incident => {
                const isResolved = dashboardState.resolvedIncidents[incident.id];
                return `
                <div class="border-l-4 pl-3 py-2 rounded cursor-pointer hover:bg-opacity-80 ${getPriorityColor(incident.priority)}" data-incident-id="${incident.id}">
                    <div class="flex items-center space-x-2 mb-1">
                        <span class="text-sm">${getIncidentIcon(incident.type)}</span>
                        <span class="text-xs font-medium text-gray-800">${incident.location}</span>
                        <span class="text-xs text-gray-600">${incident.time}</span>
                    </div>
                    <p class="text-xs text-gray-700 mb-2">${incident.message}</p>
                    <div class="flex space-x-2">
                        <button onclick="viewIncident(${incident.id})" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded transition-colors">View</button>
                        <button onclick="resolveIncident(${incident.id}, '${incident.actions[0]}')" 
                                class="text-xs ${isResolved ? 'btn-resolved' : 'bg-green-600 hover:bg-green-700'} text-white px-2 py-1 rounded transition-colors"
                                ${isResolved ? 'disabled' : ''}>
                            ${isResolved ? 'Resolved' : 'Resolve'}
                        </button>
                    </div>
                </div>
            `}).join('');
            
            if (resolvedIncidents.length > 0) {
                incidentsFeed.innerHTML += `
                    <div class="mt-4 pt-2 border-t border-gray-600">
                        <h4 class="text-xs font-semibold text-gray-400 mb-2">Recently Resolved</h4>
                        ${resolvedIncidents.slice(-2).map(incident => `
                            <div class="bg-green-900 bg-opacity-50 p-2 rounded mb-2">
                                <div class="flex items-center space-x-1">
                                    <svg class="w-3 h-3 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-xs text-green-300">${incident.location}</span>
                                </div>
                                <p class="text-xs text-green-200">Resolved: ${incident.resolvedAction}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        function updateCameraFeed() {
            const cameraContainer = document.getElementById('camera-feed-container');
            const junction = dashboardState.junctions[dashboardState.selectedJunction];
            
            cameraContainer.innerHTML = `
                <div class="camera-feed">
                    <iframe src="${trafficVideos[junction.videoId]}" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen style="width:100%;height:100%;"></iframe>
                </div>
                <div class="text-xs text-gray-400 mt-1">Live feed from ${junction.name}</div>
            `;
        }

        function updateAIRecommendations() {
            const aiPanel = document.getElementById('ai-recommendations');
            const rec = dashboardState.aiRecommendation;
            
            let content = '';
            
            if (rec.accepted === null) {
                content = `
                    <div class="bg-blue-900 p-3 rounded border border-blue-700">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-blue-300">RL Model Suggestion</span>
                            <span class="text-xs text-blue-400">${rec.confidence}% confidence</span>
                        </div>
                        <p class="text-xs text-blue-200 mb-2">${rec.suggestion}</p>
                        <p class="text-xs text-blue-300 opacity-80 mb-3">${rec.reason}</p>
                        <div class="flex space-x-2">
                            <button onclick="acceptRecommendation()" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded transition-colors">Accept</button>
                            <button onclick="declineRecommendation()" class="text-xs bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded transition-colors">Decline</button>
                        </div>
                    </div>
                `;
            } else if (rec.accepted === true) {
                content = `
                    <div class="bg-green-900 p-3 rounded border border-green-700">
                        <div class="flex items-center space-x-2 mb-1">
                            <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-xs font-medium text-green-300">Recommendation Applied</span>
                        </div>
                        <p class="text-xs text-green-200">Signal timing adjusted successfully</p>
                    </div>
                `;
            } else {
                content = `
                    <div class="bg-red-900 p-3 rounded border border-red-700">
                        <div class="flex items-center space-x-2 mb-1">
                            <svg class="w-4 h-4 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm4.707-5.293a1 1 0 00-1.414-1.414L10 11.586l-3.293-3.293a1 1 0 00-1.414 1.414l4 4a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-xs font-medium text-red-300">Recommendation Declined</span>
                        </div>
                        <p class="text-xs text-red-200">Manual control maintained</p>
                    </div>
                `;
            }
            
            content += `
                <div class="bg-green-900 p-2 rounded border border-green-700">
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-xs font-medium text-green-300">OpenCV Detection</span>
                        <span class="text-xs text-green-400">Active</span>
                    </div>
                    <p class="text-xs text-green-200">Traffic flow analysis running</p>
                </div>
            `;
            
            aiPanel.innerHTML = content;
        }

        function updateMapJunctions() {
            // Clear existing markers
            Object.values(markers).forEach(marker => {
                if (marker) map.removeLayer(marker);
            });
            markers = {};
            
            // Add markers for each junction
            Object.entries(dashboardState.junctions).forEach(([key, junction]) => {
                const isSelected = dashboardState.selectedJunction === key;
                
                // Determine marker class based on junction status
                let markerClass = junction.status;
                if (junction.emergencyVehicle) markerClass = 'emergency';
                
                // Create custom marker
                const customIcon = L.divIcon({
                    className: `junction-marker ${markerClass} ${isSelected ? 'selected' : ''}`,
                    html: `<span>${Math.round(junction.density)}%</span>`,
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });
                
                // Create marker and add to map
                const marker = L.marker(junction.coordinates, { icon: customIcon })
                    .addTo(map);
                
                // Create popup content with traffic signal visualization
                const popupContent = `
                    <div class="popup-content">
                        <div class="popup-title">${junction.name}</div>
                        <div class="popup-detail">
                            <span class="popup-label">Density:</span>
                            <span class="popup-value">${Math.round(junction.density)}%</span>
                        </div>
                        <div class="popup-detail">
                            <span class="popup-label">Queue:</span>
                            <span class="popup-value">${junction.queueLength} vehicles</span>
                        </div>
                        <div class="popup-detail">
                            <span class="popup-label">Wait Time:</span>
                            <span class="popup-value">${Math.round(junction.waitTime)}s</span>
                        </div>
                        <div class="popup-phase">
                            <div class="popup-detail">
                                <span class="popup-label">Signal:</span>
                                <span class="popup-value ${getPhaseColor(junction.phase)}">${junction.phase}</span>
                            </div>
                            <div class="popup-detail">
                                <span class="popup-label">Time Left:</span>
                                <span class="popup-value">${junction.timeLeft}s</span>
                            </div>
                        </div>
                        <div class="traffic-signal">
                            <div class="signal-direction">
                                <div class="signal-direction-label">N-S</div>
                                <div class="signal-lights">
                                    <div class="signal-light red ${junction.signalState.NS.red ? 'active' : ''}"></div>
                                    <div class="signal-light yellow ${junction.signalState.NS.yellow ? 'active' : ''}"></div>
                                    <div class="signal-light green ${junction.signalState.NS.green ? 'active' : ''}"></div>
                                </div>
                            </div>
                            <div class="signal-direction">
                                <div class="signal-direction-label">E-W</div>
                                <div class="signal-lights">
                                    <div class="signal-light red ${junction.signalState.EW.red ? 'active' : ''}"></div>
                                    <div class="signal-light yellow ${junction.signalState.EW.yellow ? 'active' : ''}"></div>
                                    <div class="signal-light green ${junction.signalState.EW.green ? 'active' : ''}"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Bind popup with close button functionality
                marker.bindPopup(popupContent, {
                    closeButton: true,
                    autoClose: false,
                    closeOnEscapeKey: true,
                    autoPan: false // Prevent auto-panning which causes blinking
                });
                
                // Store marker reference
                markers[key] = marker;
                
                // Open popup if this junction is selected and popup is not already open
                if (isSelected && dashboardState.openPopups[key]) {
                    marker.openPopup();
                }
                
                // Add click event to select junction and toggle popup
                marker.on('click', () => {
                    selectJunction(key);
                    
                    // Toggle popup
                    if (dashboardState.openPopups[key]) {
                        marker.closePopup();
                        dashboardState.openPopups[key] = false;
                    } else {
                        // Close all other popups
                        Object.keys(dashboardState.openPopups).forEach(junctionKey => {
                            if (junctionKey !== key && dashboardState.openPopups[junctionKey]) {
                                markers[junctionKey].closePopup();
                                dashboardState.openPopups[junctionKey] = false;
                            }
                        });
                        
                        marker.openPopup();
                        dashboardState.openPopups[key] = true;
                    }
                });
                
                // Handle popup close event
                marker.on('popupclose', () => {
                    dashboardState.openPopups[key] = false;
                });
            });
        }

        function updateSignalControls() {
            const signalControls = document.getElementById('signal-controls');
            const junction = dashboardState.junctions[dashboardState.selectedJunction];
            
            const phases = ['NS Green', 'NS Red', 'EW Green', 'EW Red'];
            signalControls.innerHTML = phases.map(phase => {
                const isActive = junction.phase === phase;
                const isDisabled = !dashboardState.manualOverride;
                const color = phase.includes('Green') ? 'green' : 'red';
                
                return `
                    <button onclick="handleManualSignalControl('${phase}')" 
                            ${isDisabled ? 'disabled' : ''}
                            class="p-2 rounded text-xs font-medium transition-colors ${
                                isDisabled 
                                    ? 'bg-gray-600 text-gray-400 cursor-not-allowed' 
                                    : isActive
                                        ? `bg-${color}-600 text-white`
                                        : `bg-${color}-500 hover:bg-${color}-600 text-white`
                            }">
                        ${phase}
                    </button>
                `;
            }).join('');
        }

        // Update signal states based on current phase
        function updateSignalStates() {
            Object.keys(dashboardState.junctions).forEach(key => {
                const junction = dashboardState.junctions[key];
                
                // Reset all signals
                junction.signalState.NS = { red: false, yellow: false, green: false };
                junction.signalState.EW = { red: false, yellow: false, green: false };
                
                // Set signals based on current phase
                if (junction.phase.includes('NS Green')) {
                    junction.signalState.NS.green = true;
                    junction.signalState.EW.red = true;
                } else if (junction.phase.includes('NS Yellow')) {
                    junction.signalState.NS.yellow = true;
                    junction.signalState.EW.red = true;
                } else if (junction.phase.includes('EW Green')) {
                    junction.signalState.NS.red = true;
                    junction.signalState.EW.green = true;
                } else if (junction.phase.includes('EW Yellow')) {
                    junction.signalState.NS.red = true;
                    junction.signalState.EW.yellow = true;
                } else {
                    // Default to NS red, EW red (shouldn't happen in normal operation)
                    junction.signalState.NS.red = true;
                    junction.signalState.EW.red = true;
                }
            });
        }

        // Event Handlers
        function selectJunction(junctionId) {
            dashboardState.selectedJunction = junctionId;
            document.getElementById('junction-selector').value = junctionId;
            updateDashboard();
        }

        function toggleEmergencyMode() {
            dashboardState.emergencyMode = !dashboardState.emergencyMode;
            const button = document.getElementById('emergency-toggle');
            
            if (dashboardState.emergencyMode) {
                button.className = 'px-4 py-2 rounded font-medium bg-red-600 text-white transition-colors';
                button.textContent = 'Emergency Mode ON';
            } else {
                button.className = 'px-4 py-2 rounded font-medium bg-gray-600 text-gray-300 hover:bg-gray-500 transition-colors';
                button.textContent = 'Emergency Mode OFF';
            }
            updateDashboard();
        }

        function toggleManualOverride() {
            dashboardState.manualOverride = !dashboardState.manualOverride;
            const button = document.getElementById('manual-override');
            
            if (dashboardState.manualOverride) {
                button.className = 'px-3 py-1 rounded text-xs font-medium bg-red-600 hover:bg-red-700 text-white transition-colors';
                button.textContent = 'Override ON';
            } else {
                button.className = 'px-3 py-1 rounded text-xs font-medium bg-gray-600 hover:bg-gray-500 text-white transition-colors';
                button.textContent = 'Override OFF';
            }
            updateDashboard();
        }

        function handleManualSignalControl(phase) {
            if (dashboardState.manualOverride) {
                dashboardState.junctions[dashboardState.selectedJunction].phase = phase;
                dashboardState.junctions[dashboardState.selectedJunction].timeLeft = 30;
                updateSignalStates();
                updateDashboard();
            }
        }

        function handleEmergencyPreemption() {
            dashboardState.emergencyMode = true;
            dashboardState.junctions[dashboardState.selectedJunction].phase = 'NS Green';
            dashboardState.junctions[dashboardState.selectedJunction].timeLeft = 60;
            updateSignalStates();
            
            const button = document.getElementById('emergency-toggle');
            button.className = 'px-4 py-2 rounded font-medium bg-red-600 text-white transition-colors';
            button.textContent = 'Emergency Mode ON';
            
            updateDashboard();
        }

        function acceptRecommendation() {
            dashboardState.aiRecommendation.accepted = true;
            dashboardState.junctions[dashboardState.selectedJunction].timeLeft += 15;
            
            // Update button states
            const aiPanel = document.getElementById('ai-recommendations');
            const buttons = aiPanel.querySelectorAll('button');
            buttons[0].className = 'text-xs btn-accepted text-white px-3 py-1 rounded';
            buttons[0].textContent = 'Accepted';
            buttons[0].disabled = true;
            buttons[1].className = 'text-xs btn-declined text-white px-3 py-1 rounded';
            buttons[1].textContent = 'Decline';
            buttons[1].disabled = true;
            
            updateDashboard();
        }

        function declineRecommendation() {
            dashboardState.aiRecommendation.accepted = false;
            
            // Update button states
            const aiPanel = document.getElementById('ai-recommendations');
            const buttons = aiPanel.querySelectorAll('button');
            buttons[0].className = 'text-xs btn-declined text-white px-3 py-1 rounded';
            buttons[0].textContent = 'Accept';
            buttons[0].disabled = true;
            buttons[1].className = 'text-xs btn-declined text-white px-3 py-1 rounded';
            buttons[1].textContent = 'Declined';
            buttons[1].disabled = true;
            
            updateDashboard();
        }

        function viewIncident(incidentId) {
            const incident = dashboardState.incidents.find(i => i.id === incidentId);
            if (!incident) return;
            
            const modal = document.getElementById('incident-modal');
            const modalContent = document.getElementById('modal-content');
            const junction = dashboardState.junctions[incident.junctionId];
            
            modalContent.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-lg font-bold text-white mb-1">
                            ${incident.type === 'emergency' ? 'üö® Emergency Vehicle' : ''}
                            ${incident.type === 'accident' ? '‚ö†Ô∏è Traffic Accident' : ''}
                            ${incident.type === 'congestion' ? 'üöó Traffic Congestion' : ''}
                        </h2>
                        <p class="text-sm text-gray-300">${incident.location} ‚Ä¢ ${incident.time}</p>
                    </div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <div class="camera-feed">
                            <iframe src="${trafficVideos[junction.videoId]}" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen style="width:100%;height:100%;"></iframe>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">Live feed from ${junction.name}</p>
                    </div>
                    
                    <div class="space-y-3">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-300 mb-1">Details</h4>
                            <p class="text-sm text-gray-200">${incident.details}</p>
                        </div>
                        
                        ${incident.type === 'emergency' ? `
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-400">Vehicle Type:</span>
                                    <span class="text-xs text-white">${incident.vehicleType}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-400">Direction:</span>
                                    <span class="text-xs text-white">${incident.direction}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-400">ETA:</span>
                                    <span class="text-xs text-red-400">${incident.estimatedArrival}</span>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${incident.type === 'accident' ? `
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-400">Severity:</span>
                                    <span class="text-xs text-yellow-400">${incident.severity}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-400">Vehicles:</span>
                                    <span class="text-xs text-white">${incident.vehiclesInvolved}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-400">Injuries:</span>
                                    <span class="text-xs text-green-400">${incident.injuries}</span>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${incident.type === 'congestion' ? `
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-400">Queue Length:</span>
                                    <span class="text-xs text-white">${incident.queueLength} vehicles</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-400">AI Suggestion:</span>
                                    <span class="text-xs text-blue-400">${incident.suggestion}</span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div>
                    <h4 class="text-sm font-semibold text-gray-300 mb-3">Available Actions</h4>
                    <div class="grid grid-cols-2 gap-2">
                        ${incident.actions.map(action => {
                            let buttonClass = 'bg-green-600 hover:bg-green-700';
                            if (action.includes('emergency') || action.includes('hospital')) buttonClass = 'bg-red-600 hover:bg-red-700';
                            else if (action.includes('police')) buttonClass = 'bg-blue-600 hover:bg-blue-700';
                            else if (action.includes('Clear') || action.includes('Alert')) buttonClass = 'bg-yellow-600 hover:bg-yellow-700';
                            
                            return `
                                <button onclick="resolveIncident(${incident.id}, '${action}'); closeModal();" 
                                        class="p-3 rounded text-sm font-medium transition-colors text-white ${buttonClass}">
                                    ${action.includes('hospital') ? 'üìû ' : ''}${action.includes('police') ? 'üöî ' : ''}${action}
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('incident-modal').classList.add('hidden');
        }

        function resolveIncident(incidentId, action) {
            const incidentIndex = dashboardState.incidents.findIndex(i => i.id === incidentId);
            if (incidentIndex !== -1) {
                dashboardState.incidents[incidentIndex].resolved = true;
                dashboardState.incidents[incidentIndex].resolvedAction = action;
                dashboardState.incidents[incidentIndex].resolvedTime = new Date().toLocaleTimeString();
                dashboardState.resolvedIncidents[incidentId] = true;
            }
            
            // Simulate action execution
            if (action === 'Contact nearest hospital') {
                alert('üìû Contacted Apollo Hospital Chennai - ETA: 8 minutes');
            } else if (action === 'Dispatch traffic police') {
                alert('üöî Traffic police dispatched from T. Nagar station - ETA: 5 minutes');
            } else if (action === 'Clear traffic signal') {
                handleEmergencyPreemption();
                alert('üö¶ Emergency signal preemption activated');
            } else if (action === 'Alert nearby junctions') {
                alert('‚ö†Ô∏è Nearby junctions alerted - Emergency corridor established');
            } else if (action === 'Contact emergency services') {
                alert('üö® Emergency services contacted - Ambulance priority granted');
            } else if (action === 'Redirect traffic') {
                alert('üöó Traffic redirection activated via alternate routes');
            }
            
            updateDashboard();
        }

        function updateDashboard() {
            updateTime();
            updateMetrics();
            updateIncidentsFeed();
            updateCameraFeed();
            updateAIRecommendations();
            updateMapJunctions();
            updateSignalControls();
        }

        // Signal phase cycling
        function cycleSignalPhases() {
            if (!dashboardState.manualOverride) {
                Object.keys(dashboardState.junctions).forEach(key => {
                    const junction = dashboardState.junctions[key];
                    
                    if (junction.timeLeft > 0) {
                        junction.timeLeft -= 1;
                    } else {
                        // Move to next phase
                        const currentPhaseIndex = junction.phases.indexOf(junction.phase);
                        const nextPhaseIndex = (currentPhaseIndex + 1) % junction.phases.length;
                        junction.phase = junction.phases[nextPhaseIndex];
                        
                        // Set time for new phase
                        if (junction.phase.includes('Yellow')) {
                            junction.timeLeft = 5;
                        } else if (junction.phase.includes('Green')) {
                            junction.timeLeft = dashboardState.emergencyMode ? 60 : 30;
                        } else {
                            junction.timeLeft = dashboardState.emergencyMode ? 20 : 25;
                        }
                    }
                });
                
                // Update signal states based on new phases
                updateSignalStates();
                updateDashboard();
            }
        }

        // Simulate real-time data updates
        function simulateTrafficData() {
            const junction = dashboardState.junctions[dashboardState.selectedJunction];
            junction.density = Math.max(10, Math.min(100, junction.density + (Math.random() - 0.5) * 5));
            junction.waitTime = Math.max(5, junction.waitTime + (Math.random() - 0.5) * 10);
            
            // Update junction status based on density
            if (junction.density > 70) junction.status = 'high';
            else if (junction.density > 40) junction.status = 'medium';
            else junction.status = 'low';
            
            updateDashboard();
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the map
            initMap();
            
            // Set up event listeners
            document.getElementById('emergency-toggle').addEventListener('click', toggleEmergencyMode);
            document.getElementById('manual-override').addEventListener('click', toggleManualOverride);
            document.getElementById('emergency-preemption').addEventListener('click', handleEmergencyPreemption);
            document.getElementById('junction-selector').addEventListener('change', function(e) {
                selectJunction(e.target.value);
            });

            // Close modal when clicking outside
            document.getElementById('incident-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // Initialize signal states
            updateSignalStates();
            
            // Initialize dashboard
            updateDashboard();
            
            // Set up intervals
            setInterval(updateTime, 1000);
            setInterval(cycleSignalPhases, 1000);
            setInterval(simulateTrafficData, 3000);
        });
    </script>
</body>
</html>
